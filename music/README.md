# STM32F407VET6 无源蜂鸣器音乐播放项目

## 项目简介

这是一个基于STM32F407VET6开发板的无源蜂鸣器音乐播放项目。项目使用CubeMX生成的基础框架，通过GPIO引脚产生方波信号来驱动无源蜂鸣器播放音乐。

## 硬件要求

- STM32F407VET6开发板
- 无源蜂鸣器（连接到PA0引脚）
- 连接线

## 硬件连接

将无源蜂鸣器的正极连接到PA0引脚，负极连接到GND。

## 功能特性

### 1. 音乐播放功能
- 支持播放单音符
- 支持播放完整旋律
- 支持音乐循环播放
- 支持播放/暂停/停止控制

### 2. 内置音乐
- 小星星 (Twinkle Twinkle Little Star)
- 生日快乐歌 (Happy Birthday)
- 音阶练习 (Scale)

### 3. 音符支持
支持以下音符频率：
- C4 (262Hz) 到 C6 (1047Hz)
- 支持不同音符长度：八分音符、四分音符、二分音符、全音符

## 文件结构

```
Core/
├── Inc/
│   ├── main.h          # 主程序头文件
│   ├── gpio.h          # GPIO配置头文件
│   └── music.h         # 音乐播放功能头文件
└── Src/
    ├── main.c          # 主程序
    ├── gpio.c          # GPIO配置
    └── music.c         # 音乐播放功能实现
```

## 主要函数说明

### 音乐播放函数
- `Music_Init()`: 初始化音乐播放功能
- `Music_PlayNote(frequency, duration)`: 播放单个音符
- `Music_PlayMelody(melody, length)`: 播放完整旋律
- `Music_Stop()`: 停止播放
- `Music_Toggle()`: 播放/暂停切换
- `Music_Update()`: 更新音乐播放状态（需要在主循环中调用）

### 便捷播放函数
- `Music_PlayTwinkle()`: 播放小星星
- `Music_PlayBirthday()`: 播放生日快乐歌
- `Music_PlayScale()`: 播放音阶

## 使用方法

### 1. 编译和下载
1. 使用STM32CubeIDE或其他支持STM32的IDE打开项目
2. 编译项目
3. 将程序下载到STM32F407VET6开发板

### 2. 运行效果
程序启动后会自动播放音乐演示：
- 每30秒自动切换一首歌
- 播放顺序：小星星 → 生日快乐歌 → 音阶 → 循环

### 3. 自定义音乐
可以通过修改`music.c`文件中的旋律数组来添加新的音乐：

```c
static const Note_t melody_custom[] = {
    {NOTE_C4, QUARTER_NOTE},  // 播放C4音符，持续500ms
    {NOTE_D4, HALF_NOTE},     // 播放D4音符，持续1000ms
    // ... 更多音符
};
```

## 技术原理

### 方波生成
项目通过GPIO引脚产生方波信号来驱动无源蜂鸣器：
1. 根据音符频率计算方波周期
2. 通过GPIO高低电平切换产生方波
3. 使用精确的延时控制方波频率

### 音符频率
每个音符对应特定的频率：
- C4: 262Hz
- D4: 294Hz
- E4: 330Hz
- F4: 349Hz
- G4: 392Hz
- A4: 440Hz
- B4: 494Hz
- C5: 523Hz
- 等等...

## 注意事项

1. **引脚配置**: 确保PA0引脚已正确配置为输出模式
2. **蜂鸣器类型**: 必须使用无源蜂鸣器，有源蜂鸣器无法播放音乐
3. **电源供应**: 确保开发板有足够的电源供应
4. **音量控制**: 可以通过调整蜂鸣器的供电电压来控制音量

## 扩展功能

可以进一步扩展的功能：
1. 添加更多音乐曲目
2. 实现音量控制
3. 添加按键控制播放
4. 实现音乐文件播放
5. 添加LED指示灯显示播放状态

## 故障排除

### 常见问题
1. **没有声音**: 检查蜂鸣器连接和引脚配置
2. **音调不准**: 检查系统时钟配置和延时函数
3. **音量太小**: 检查蜂鸣器供电电压

### 调试方法
1. 使用示波器观察PA0引脚的波形
2. 使用万用表测量引脚电压
3. 添加LED指示灯显示程序运行状态

## 许可证

本项目基于STMicroelectronics的HAL库开发，遵循相应的开源许可证。 